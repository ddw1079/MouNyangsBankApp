<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/base}">
<head>
<title layout:fragment="title">모으냥즈 | 송금하기</title>
<!-- ✅ 공통 헤더/푸터 CSS/JS는 layout/base에서 포함됨. 여기서는 페이지 전용 CSS만 링크 -->
<link rel="stylesheet" th:href="@{/css/transfer/transfer.css}" />


<!-- headr footer가 달리는 모든 페이지에 갖다 붙일것 -->
<link rel="icon" href="http://localhost:8810/images/cat.ico" type="image/x-icon" />
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="http://localhost:8810/css/header-footer.css" />
<script defer src="http://localhost:8810/js/token-exp-display.js"></script>
<script defer src="http://localhost:8810/js/common.js"></script>
<script defer src="http://localhost:8810/js/adminservice.js"></script>
<script defer src="http://localhost:8810/js/bankservice.js"></script>
<script defer src="http://localhost:8810/js/cardservice.js"></script>
<script defer src="http://localhost:8810/js/transactionservice.js"></script>
<!-- 이것도 같이 붙여야함 toggle switch 만들기 -->
<link rel="stylesheet" href="http://localhost:8810/css/theme.css">
<link rel="stylesheet" href="http://localhost:8810/css/toggle.css">
<script defer src="http://localhost:8810/js/theme.js"></script>


</head>
<body>
	<div id="header"></div>
	<section id="transfer" class="page" layout:fragment="content">
		<!-- ✅ 공통 헤더/푸터는 layout/base가 렌더링할 때 자동 포함 -->


		<div class="tf-card" aria-labelledby="tfTitle">
			<div class="tf-title" id="tfTitle">
				🐾 송금하기 <span class="pill"><i class='bx bx-shield-quarter'></i> 안전한 결제</span>
			</div>
			<p class="tf-desc">받는 사람을 확인하고 금액을 입력하세요. 송금 전 한 번 더 확인합니다.</p>

			<!-- ====== 입력 영역 ====== -->
			<div class="tf-form" id="tfForm">


				<div class="row">
					<div class="label">받는 사람</div>
					<div class="field">
						<div class="recipient">
							<div class="avatar" id="avatar">NY</div>
							<input type="text" class="input" id="toName" placeholder="닉네임 또는 계좌/전화번호" aria-label="받는 사람" />
						</div>
					</div>
				</div>


				<div class="row">
					<div class="label">출금 수단</div>
					<div class="field">
						<select id="fromAccount" class="select" aria-label="출금 수단">
							<option value="" selected>선택하세요</option>

							<!-- 계좌 옵션 렌더링 -->
							<option th:each="acc : ${acclist}" th:value="${acc.id}" th:data-number="${acc.number}" th:data-type="${acc.type}" th:data-icon="${acc.icon}" th:data-product="${acc.product}" th:text="${acc.name} + ' • ' + ${acc.number}">계좌명 • 계좌번호</option>
						</select>
						<!-- 계좌가 하나도 없을 때 -->
						<div class="help" th:if="${#lists.isEmpty(acclist)}">보유한 출금 수단이 없습니다. 먼저 계좌를 추가하세요.</div>
					</div>
				</div>


				<div class="row">
					<div class="label">금액</div>
					<div class="field">
						<input type="text" inputmode="numeric" class="input" id="amount" placeholder="" aria-label="송금 금액" autocomplete="off" />

						<div class="quick" style="margin-top: 8px">
							<button type="button" data-amt="10000">+1만</button>
							<button type="button" data-amt="50000">+5만</button>
							<button type="button" data-amt="100000">+10만</button>
							<button type="button" data-amt="-10000">-1만</button>
						</div>
					</div>
				</div>


				<div class="row">
					<div class="label">
						메모 <span class="pill" title="선택">선택</span>
					</div>
					<div class="field">
						<textarea id="memo" class="textarea" placeholder="예) 커피값"></textarea>
					</div>
				</div>


				<div class="actions">
					<button class="btn btn-ghost" type="button" id="btnCancel">취소</button>
					<button class="btn btn-primary" type="button" id="btnSend" disabled>송금하기</button>
				</div>


				<!-- 진행 애니메이션 / 완료 화면 -->
				<div class="progress" id="tfProgress" aria-live="polite">
					<div class="coin"></div>
					처리 중…
				</div>
				<div class="done" id="tfDone" role="status" aria-live="polite">
					<div class="cat">😺💸</div>
					<h2>송금 완료!</h2>
					<p class="desc">
						<span id="doneName">상대방</span>께 <b id="doneAmt">0원</b>을 보냈습니다.
					</p>
					<p class="desc">3초 후 자동으로 거래내역으로 이동합니다…</p>
				</div>
			</div>

			<!-- 실패 화면 -->
			<div class="fail" id="tfFail" role="status" aria-live="polite">
				<div class="cat">😿😿</div>
				<h2>송금 실패</h2>
				<p class="desc">
					<span id="errorReason">오류입니다</span>
				</p>
				<p class="desc">3초 후 자동으로 은행 인덱스 페이지로 이동합니다…</p>
			</div>
		</div>



		<!-- 결제 비밀번호(=계정 비밀번호) 모달 -->
		<div class="modal" id="pwModal" aria-hidden="true" role="dialog" aria-labelledby="pwTitle" aria-modal="true">
			<div class="panel" role="document">
				<h3 id="pwTitle">비밀번호 확인</h3>
				<p class="tf-desc">
					<span id="sendName">상대방</span>께 <b id="sendAmt">0원</b>을 보냅니다.
				</p>
				<p class="tf-desc">송금 전에 계정 비밀번호를 한 번 더 확인합니다.</p>

				<div class="pw-field">
					<input type="password" class="input" id="accountPw" placeholder="계정 비밀번호" autocomplete="current-password" aria-describedby="pwHelp pwError" />
					<button type="button" class="eye" id="btnTogglePw" aria-label="비밀번호 표시 전환"></button>
				</div>

				<div class="pw-meta">
					<span id="pwHelp" class="help">8자 이상 권장</span> <span id="pwError" class="error" aria-live="polite" hidden></span>
				</div>

				<div class="actions">
					<button class="btn btn-ghost" type="button" id="btnPwCancel">취소</button>
					<button class="btn btn-primary" type="button" id="btnPwOK" disabled>확인</button>
				</div>
			</div>
		</div>


		<!-- 효과음 (성공 시) -->
		<audio id="sndSuccess" preload="auto">
			<source th:src="@{/audio/coin-success.mp3}" src="/audio/coin-success.mp3" type="audio/mpeg" />
		</audio>


	</section>


	<!-- 페이지 전용 JS (공통은 수정 금지) -->
	<th:block layout:fragment="scripts">
		<script th:src="@{/js/transfer/transfer.js}"></script>
	</th:block>
	<div id="footer"></div>
</body>
</html>