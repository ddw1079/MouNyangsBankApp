<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sboot.moabayo.dao.MyPageMapper">

	<!-- 총 잔액 합계 -->
	<select id="selectSumBalance" parameterType="string"
		resultType="int">
		SELECT NVL(SUM(ua.balance), 0) AS asset
		FROM user_account ua
		WHERE ua.user_id = #{userId}
	</select>

	<!-- 계좌 수 -->
	<select id="selectAccountCount" parameterType="string"
		resultType="int">
		SELECT COUNT(*) AS account_count
		FROM user_account
		WHERE
		user_id = #{userId}
	</select>

	<!-- 카드 수 -->
	<select id="selectCardCount" parameterType="string"
		resultType="int">
		SELECT COUNT(*) AS card_count
		FROM user_card
		WHERE user_id =
		#{userId}
	</select>

	<!-- 프로필 매핑 -->
	<resultMap id="ProfileMap" type="com.sboot.moabayo.vo.UserVO">
		<!-- 필요시 PK 매핑 -->
		<!-- <id property="userId" column="user_id"/> -->
		<result property="name" column="name" />
		<result property="phone" column="phone" />
		<result property="email" column="email" />
		<result property="address" column="address" />
		<result property="addressDetail"  column="address_detail"/>  <!-- ★ -->
		<result property="zipcode" column="zipcode" />
	</resultMap>

	<!-- 프로필 조회 -->
	<select id="selectProfile" parameterType="long"
		resultMap="ProfileMap">
		SELECT name, phone, email, address
		FROM users
		WHERE user_id =
		#{userId}
	</select>

	<!-- 프로필 업데이트 -->
  <update id="updateProfile" parameterType="map">
    UPDATE users
    <set>
      <if test="p.name           != null">name           = #{p.name},</if>
      <if test="p.phone          != null">phone          = #{p.phone},</if>
      <if test="p.email          != null">email          = #{p.email},</if>
      <if test="p.address        != null">address        = #{p.address},</if>
      <if test="p.addressDetail  != null">address_detail = #{p.addressDetail},</if>
      <if test="p.zipCode           != null">zipCode            = #{p.zipCode},</if>
    </set>
    WHERE user_id = #{userId}
  </update>

	<!-- 비밀번호 업데이트 -->
	<update id="updatePassword">
		UPDATE users
		SET password = #{enc}
		WHERE user_id =
		#{userId}
	</update>

</mapper>